{% assign course = site.teachings | where: 'course_id', include.course_id | first %}

{% if course %}
  <div class="course-schedule mb-5">
    
    <h3 class="mb-4 pl-3 schedule-title" style="border-left: 4px solid var(--global-theme-color); line-height: 1;">
      {{ course.title }} - Schedule
    </h3>

    {% if course.instructor or course.term %}
    <div class="mb-3 text-muted small">
      {% if course.instructor %}
        <span class="mr-3"><i class="fa-solid fa-user-tie mr-1"></i>{{ course.instructor }}</span>
      {% endif %}
      {% if course.term %}
        <span><i class="fa-regular fa-calendar mr-1"></i>{{ course.term }}</span>
      {% endif %}
    </div>
    {% endif %}

    {% if course.description %}
      <div class="course-description mb-4 text-muted">
        {{ course.description | markdownify }}
      </div>
    {% endif %}

    {% if course.schedule %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="thead-light">
            <tr>
              <th scope="col" style="width: 15%;">Date / Week</th>
              <th scope="col" style="width: 25%;">Topic</th>
              <th scope="col" style="width: 40%;">Description</th>
              <th scope="col" style="width: 20%;">Materials</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in course.schedule %}
            <tr>
              <td class="align-middle" style="white-space: nowrap;">
                <span class="font-weight-bold table-text-primary" style="font-size: 1.05rem;">{{ entry.date }}</span>
                <br>
                <span class="text-muted small text-uppercase" style="letter-spacing: 0.5px;">Week {{ entry.week }}</span>
              </td>
              
              <td class="align-middle font-weight-bold table-text-primary">
                {{ entry.topic }}
              </td>
              
              <td class="align-middle text-muted">
                {{ entry.description | markdownify }}
              </td>
              
              <td class="align-middle">
                {% if entry.materials %}
                  {% for material in entry.materials %}
                    {% if material.url %}
                      {% assign mat_url = material.url %}
                      {% unless material.url contains '://' %}
                        {% assign mat_url = material.url | relative_url %}
                      {% endunless %}
                      
                      <a href="{{ mat_url }}" target="_blank" class="badge badge-light border text-primary mb-1 p-2 shadow-sm material-btn" style="font-weight: 500; display: inline-block;">
                        <i class="fa-solid fa-file-arrow-down mr-1"></i> {{ material.name }}
                      </a>
                    {% else %}
                      <span class="badge badge-light border text-muted mb-1 p-2">
                        {{ material.name }}
                      </span>
                    {% endif %}
                    <br> 
                  {% endfor %}
                {% else %}
                  <span class="text-muted small">-</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-light" role="alert">
        No schedule available for this course.
      </div>
    {% endif %}
  </div>

  <style>
    /* 默认 Light Mode */
    .table-text-primary {
      color: #000;
    }
    .schedule-title {
      color: #000;
    }

    /* Dark Mode 适配 */
    body.dark .table-text-primary {
      color: #e0e0e0 !important; /* 变白 */
    }
    body.dark .schedule-title {
      color: #e0e0e0 !important; /* 变白 */
    }

    /* 按钮微交互 */
    .material-btn {
      transition: all 0.2s;
    }
    .material-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
    }
  </style>

{% endif %}